[gcode_macro MECHANICAL_GANTRY_CALIBRATION]
gcode:
    {% set x_max = printer.toolhead.axis_maximum.x %} 
    {% set y_max = printer.toolhead.axis_maximum.y %} 
    {% set z_max = printer.toolhead.axis_maximum.z %} 
    {% set fast_move_z = printer.configfile.settings["printer"].max_z_velocity %}
    {% set fast_move = printer.configfile.settings["printer"].max_velocity %}
	G28 ; Home All Axis
	G90 ; Absolute Position
	G0 X{x_max / 2} Y{y_max / 2} F{fast_move * 30 } ; center print head
	G0 Z{z_max -1} F{fast_move_z * 60 } ; go to the Z-max at speed max z speed
	SET_KINEMATIC_POSITION Z={z_max - 15} ; Trick printer into beleiving the X-gantry is 10mm lower
	G1 Z{z_max} F{6 * 15} ; try to move 10mm up slowly
	G4 P200 ; Wait
	G1 Z{z_max -6} F{6 * 60} ; move 4mm down
	G4 P200 ; same as the first one
	G1 Z{z_max -30} F{6 * 60} ; move to 30mm below z-max to allow homing movement
	G4 P200 ; same as the first one
	G28 ; we MUST home again.
